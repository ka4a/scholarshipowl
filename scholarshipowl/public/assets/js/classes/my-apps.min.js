var MyAppsTable=Element.extend({_init:function(s){this._super(s),$(s).find("tbody tr").remove(),this.fillTable()},fillTable:function(){var s=this,e="/api/v1.0/my-applications",a="get",t="json",o=new Ajax(e,a,t);o.onBeforeSend=function(e){$(s).find("tbody tr").remove()},o.onError=function(s,e,a){},o.onSuccess=function(e){if($(".MyAppsTable").find("tbody tr").remove(),"ok"==e.status){if($.isEmptyObject(e.data.scholarships)){var a='<tr><td colspan="100"><div id="scholarshipLimitError" class="text-center row"><small data-error="scholarships-limit" class="help-block text-center">No applications have been submitted yet.<br />Hit \'Apply Now\' to get your applications submitted.</small></div></td></tr>';s.getSelector().find("tbody").append(a)}else{for(var t in e.data.scholarships){var o=e.data.scholarships[t],a='<tr id="row'+o.scholarship_id+'" class="clickable">';a+='<td class="mod-td-checkbox"><input name="apply[]" type="checkbox" value="'+o.scholarship_id+'"',"Submitted"==o.application_status?a+=' disabled="disabled"':"Ready to submit"==o.application_status&&(a+=' checked="checked"'),a+=' /><span class="lbl padding-0"></span><input type="hidden" name="status[]" value="'+o.application_status+'" /></td>';var r=o.expiration_date.split("/"),n=r[2]+r[0]+r[1];a+='<td data-text="'+n+'">'+o.expiration_date+"</td>",a+='<td><strong><a href="#" class="toggle">'+o.title+"</a></strong></td>";var i=0;for(var p in o.essays)o.essays.hasOwnProperty(p)&&++i;var c="",d=1==i?"Submitted"==o.application_status?"EssayView":"EssayWrite":"toggle";switch(1==i&&(c='data-essay="'+o.essays[p].essay_id+'" data-scholarship="'+o.scholarship_id+'"'),o.essay_status){case"Done":a+='<td data-text="4"><span class="text-success"><a href="#" '+c+' class="'+d+'">'+o.essay_status+"</a></span>";break;case"No Essay Needed":a+='<td data-text="3"><span class="text-success">'+o.essay_status+"</span>";break;case"In Progress":a+='<td data-text="1"><span class="text-success"><a href="#" '+c+' class="'+d+'">'+o.essay_status+"</a></span>";break;case"Not Started":a+='<td data-text="2"><a href="#" '+c+' class="'+d+'">'+o.essay_status+"</a>";break;default:a+='<td data-text="4"><a href="#" '+c+' class="'+d+'">'+o.essay_status+"</a>"}switch(a+="</td>",o.application_status){case"Submitted":a+='<td data-text="3"><span class="text-success">'+o.application_status+"</span>";break;case"Ready to submit":a+='<td data-text="2"><span class="text-success">'+o.application_status+"</span>";break;default:a+='<td data-text="1">'+o.application_status}if(a+="</td>",a+="<td><strong>$"+o.amount+"</strong></td>",a+="</tr>",a+='<tr class="tablesorter-childRow">',a+="<td>&nbsp</td>",a+='<td class="expanded-row" colspan="2"><p><a href="'+o.url+'" target="_blank">'+o.url+"</a>&nbsp;</p><p>"+o.description+"</p></td>",a+='<td class="expanded-row" colspan="3">',!$.isEmptyObject(o.essays)){var l=o.essays;for(var u in l)a+="Submitted"==o.application_status?'<a data-essay="'+l[u].essay_id+'" data-scholarship="'+o.scholarship_id+'" class="EssayView" href="#"><h4>Essay: '+l[u].title+"</h4></a>":'<a data-essay="'+l[u].essay_id+'" data-scholarship="'+o.scholarship_id+'" class="EssayWrite" href="#"><h4>Essay: '+l[u].title+"</h4></a>",a+="<p>"+l[u].description+"</p>"}a+="</td>",a+="</tr>",s.getSelector().find("tbody").append(a)}s.getSelector().tablesorter({sortList:[[4,0]]}),s.getSelector().trigger("update"),$("#default-sort").addClass("tablesorter-headerAsc")}$(".EssayView").each(function(){new EssayView($(this))}),$(".EssayWrite").each(function(){new EssayWrite($(this))})}else if("error"==e.status)switch(e.data){case-1:alert("System error");break;case 1e3:alert("Apply not selected");break;case 1001:alert("Apply payed members only");break;case 1002:alert("Apply no credit")}else"redirect"==e.status&&(window.location=e.message)},o.sendRequest()},objSize:function(s){var e=0;if("object"==typeof s)if(Object.keys)e=Object.keys(s).length;else if(window._)e=_.keys(s).length;else if(window.$)e=$.map(s,function(){return 1}).length;else for(var a in s)s.hasOwnProperty(a)&&e++;return e}}),MyAppsSubmitButton=Class.extend({_init:function(s){var e=this;s.click(function(s){s.preventDefault();var a=e.onBeforeAction.apply(e,arguments);if(0==a)return!1;var t="/api/v1.0/my-applications",o="put",r="json",n=new Object,i=$('input[name="apply[]"]:checked').map(function(){return $(this).val()}).get();n.scholarships=i,n=JSON.parse(JSON.stringify(n));var p=new Ajax(t,o,r,n);p.onBeforeSend=function(s){},p.onSuccess=function(s){e.onSuccess.apply(e,arguments)},p.onError=function(s,a,t){e.onError.apply(e,arguments)},p.onComplete=function(){},p.sendRequest()})},onBeforeAction:function(){var s=$.find('input[name="apply[]"]:checked').length;return 0==s?($("#Popup .modal-body").html("Please select at least one scholarship to submit before you proceed."),$("#Popup .modal-footer").html('<a type="button" class="btn btn-primary center-block" data-dismiss="modal">Ok</a>'),$("#Popup").modal("show"),!1):!0},onSuccess:function(s){if("ok"==s.status){var e="",a="";""!=s.data.incomplete?e="Some of the selected scholarships could not be submitted.":(e="Your scholarship applications will be processed within one hour.",a=s.message),$("#Popup .modal-body").html(e),$("#Popup .modal-footer").html('<a type="button" class="btn btn-primary center-block"'+(""==a?' data-dismiss="modal"':'href="'+a+'"')+">Ok</a>"),$("#Popup").modal("show"),""!=a&&($("#Popup").on("hide.bs.modal",function(){window.top.location.href=a}),setTimeout("window.top.location.href = '"+a+"';",1e4))}else if("redirect"==s.status)if("essays"==s.message){var e="Your scholarship applications will be processed within one hour.",a=s.message;$("#Popup .modal-body").html(e),$("#Popup .modal-footer").html('<a type="button" class="btn btn-primary center-block" href="'+a+'">Continue</a>'),$("#Popup").modal("show")}else window.location=s.message;else"error"==s.status&&($("#Popup .modal-body").html(s.message),$("#Popup .modal-footer").html('<a type="button" class="btn btn-primary center-block" data-dismiss="modal">Ok</a>'),$("#Popup").modal("show"))}}),MyAppsRemoveButton=Class.extend({_init:function(s){var e=!1;s.click(function(s){s.preventDefault();var a=$.find('input[name="apply[]"]:checked').length;if(0==a)return $("#Popup .modal-body").html("Please select at least one scholarship to remove before you proceed."),$("#Popup .modal-footer").html('<a type="button" class="btn btn-warning center-block" data-dismiss="modal">Ok</a>'),$("#Popup").modal("show"),!1;for(var t=$('input[name="apply[]"]:checked'),o=!1,r=0;a>r;r++)if("Submitted"==t.nextAll("input").first().val())var o=!0;return o?($("#Popup .modal-body").html("Applications to some of your selected scholarships have already been sent. Please review your selection."),$("#Popup .modal-footer").html('<a type="button" class="btn btn-primary" data-dismiss="modal">Ok</a>'),$("#Popup").modal("show"),!1):($("#Popup .modal-body").html("Are you sure you want to remove these scholarship applications from your selection?"),$("#Popup .modal-footer").html(),$("#Popup .modal-footer").html('<div class="row"><div class="col-md-6"><a type="button" class="btn btn-info btn-primary buttonProceed" data-dismiss="modal">Proceed</a></div><div class="col-md-6"><a type="button" class="btn btn-warning" data-dismiss="modal">Cancel</a></div></div>'),$("#Popup").modal("show").one("click",".buttonProceed",function(){var s="/api/v1.0/my-applications",a="delete",t="json",o=new Object,r=$('input[name="apply[]"]:checked').map(function(){return $(this).val()}).get();o.scholarships=r,o=JSON.parse(JSON.stringify(o));var n=new Ajax(s,a,t,o);n.onSuccess=function(s){if(e=!1,"ok"==s.status){var a="The selected scholarships have been removed. You can reselect them any time.",t=s.data.scholarships.length,o=parseInt($("#credit").text().trim());$("#credit").text(o+t),$("#Popup .modal-body").html(a),$("#Popup .modal-footer").html('<a type="button" class="btn btn-primary center-block" data-dismiss="modal">Continue</a>'),$("#Popup").modal("show"),new MyAppsTable($(".MyAppsTable"));var r=new SubscriptionNotification;r.load()}else if("redirect"==s.status)if("essays"==s.message){var a="You will be redirected to next page.",n=s.message;$("#Popup .modal-body").html(a),$("#Popup .modal-footer").html('<a type="button" class="btn btn-primary center-block" href="'+n+'">Continue</a>'),$("#Popup").modal("show"),setTimeout('window.top.location.href = "'+n+'";',1e4)}else window.location=s.message;else"error"==s.status&&($("#Popup .modal-body").html(s.message),$("#Popup .modal-footer").html('<a type="button" class="btn btn-primary center-block" data-dismiss="modal">Ok</a>'),$("#Popup").modal("show"))},e||(n.sendRequest(),e=!0)}),$(".buttonConfirm").off(),void 0)})}}),EssayView=Class.extend({_init:function(s){s.off().click(function(e){e.preventDefault();var a=s.attr("data-essay"),t=s.attr("data-scholarship");if(a){var o=new Ajax("/api/v1.0/essay","get","json",{essayId:a,scholarshipId:t}),r=$("input[name=_token]").val();o.onBeforeSend=function(s){s.setRequestHeader("X-CSRF-Token",r)},o.onSuccess=function(s){if("ok"==s.status){var e=s.data.essay;$("#essay-popup #essay-title").html(e.title),$("#essay-popup #essay-scholarship").html(e.scholarship_title),$("#essay-popup #essay-subtitle").html(e.title);var a="";e.min_words>0?a+=e.max_words>0?e.min_words+" to "+e.max_words+" words":1==e.min_words?"Any number of characters.":"Minimum "+e.min_words+" words":e.max_words>0?a+="Up to "+e.max_words+" words":e.min_characters>0?a+=e.max_characters>0?e.min_characters+" to "+e.max_characters+" characters":1==e.min_characters?"Any number of characters.":"Minimum "+e.min_characters+" characters":e.max_characters>0&&(a+="Up to "+e.max_characters+" characters"),$("#essay-popup #essay-complexity").html(a),$("#essay-popup #essay-deadline-small").html(e.expiration_date),$("#essay-popup #essay-deadline").html(e.expiration_date),$("#essay-popup #scholarship-amount").html("$"+e.scholarship_amount),$("#essay-popup #essay-description").html(e.description),$("#essay-popup #essay-text").html("<div>"+e.text+"</div>"),$("#essay-popup #essay-button").html('<button class="btn btn-danger text-uppercase pull-left" data-dismiss="modal">Close</button>'),$("#essay-popup #essay-status").hide(),$("#essay-popup #word-count").html(EssayWrite.prototype.wordCount(e.text).words),$("#essay-popup #character-count").html(EssayWrite.prototype.wordCount(e.text).characters),$("#essay-popup").modal("show")}},o.sendRequest()}})}}),EssayWrite=Class.extend({_init:function(s){s.off().click(function(e){e.preventDefault();var a=s.attr("data-essay"),t=s.attr("data-scholarship");if(a){var o=new Ajax("/api/v1.0/essay","get","json",{essayId:a,scholarshipId:t}),r=$("input[name=_token]").val();o.onBeforeSend=function(s){s.setRequestHeader("X-CSRF-Token",r)},o.onSuccess=function(s){if("ok"==s.status){var e=s.data.essay;$("body").data("essay",e),$("#essay-popup #essay-title").html(e.title),$("#essay-popup #essay-scholarship").html(e.scholarship_title),$("#essay-popup #essay-subtitle").html(e.title);var t="";e.min_words>0?t+=e.max_words>0?e.min_words+" to "+e.max_words+" words":1==e.min_words?"Any number of characters.":"Minimum "+e.min_words+" words":e.max_words>0?t+="Up to "+e.max_words+" words":e.min_characters>0?t+=e.max_characters>0?e.min_characters+" to "+e.max_characters+" characters":1==e.min_characters?"Any number of characters.":"Minimum "+e.min_characters+" characters":e.max_characters>0&&(t+="Up to "+e.max_characters+" characters"),$("#essay-popup #essay-complexity").html(t),$("#essay-popup #essay-deadline-small").html(e.expiration_date),$("#essay-popup #essay-deadline").html(e.expiration_date),$("#essay-popup #scholarship-amount").html("$"+e.scholarship_amount),$("#essay-popup #essay-description").html(e.description),$("#essay-popup #essay-text").html('<textarea class="form-control" name="essay-edit" id="essay-edit">'+e.text+"</textarea>"),$("#essay-popup #essay-text").append('<input type="hidden" name="essay-id" id="essay-id" value="'+a+'" />'),$("#essay-popup #essay-button").html('<button class="btn btn-primary text-uppercase pull-left SaveEssay">Save essay</button>'),$("#essay-popup #essay-finished").replaceWith('<input type="checkbox" name="essay-finished" id="essay-finished" '+(1==e.status?' value="on" checked="checked" ':"")+(1==EssayWrite.prototype.isEssayCompliant(e,e.text)?"":" disabled ")+" >"),$("#essay-popup #essay-finished").click(function(){var s=$("body").data("essay"),e=$("#essay-edit").val();EssayWrite.prototype.isEssayCompliant(s,e)||($("#essay-popup #essay-finished").prop("checked",!1),$("#essay-popup #essay-finished").prop("disabled",!0),alert("Your essay does not meet character or word count requirements."))}),$("#essay-popup #essay-status").show(),$("#essay-popup #word-count").html(EssayWrite.prototype.wordCount(e.text).words),$("#essay-popup #character-count").html(EssayWrite.prototype.wordCount(e.text).characters),$(".SaveEssay").each(function(){new SaveEssay($(this))}),$("#essay-popup").modal("show"),$("#essay-popup").one("hide.bs.modal",SaveEssay.prototype.process),$("#essay-popup #essay-edit").keyup(function(){var s=$("body").data("essay"),e=$("#essay-edit").val();$("#essay-popup #essay-finished").prop("disabled",!EssayWrite.prototype.isEssayCompliant(s,e)),$("#essay-popup #word-count").html(EssayWrite.prototype.wordCount(e).words),$("#essay-popup #character-count").html(EssayWrite.prototype.wordCount(e).characters)})}},o.sendRequest()}})},isEssayCompliant:function(s,e){var a=EssayWrite.prototype.wordCount(e);return parseInt(s.min_words)&&a.words<parseInt(s.min_words)?!1:parseInt(s.max_words)&&a.words>parseInt(s.max_words)?!1:parseInt(s.min_characters)&&a.characters<parseInt(s.min_characters)?!1:parseInt(s.max_characters)&&a.characters>parseInt(s.max_characters)?!1:!0},isEssayFinished:function(s,e){var a=EssayWrite.prototype.wordCount(e);if(!EssayWrite.prototype.isEssayCompliant(s,e))return!1;if(parseInt(s.max_words))if(parseInt(s.min_words)<=1){if(a.words<parseInt(s.max_words))return!1}else if(a.words>parseInt(s.max_words))return!1;if(parseInt(s.max_characters))if(parseInt(s.min_characters)<=1){if(a.characters<parseInt(s.max_characters))return!1}else if(a.characters>parseInt(s.max_characters))return!1;return!0},wordCount:function(s){return{charactersNoSpaces:s?s.replace(/\s+/g,"").length:0,characters:s?s.length:0,words:s?s.match(/\S+/g).length:0,lines:s?s.split(/\r*\n/).length:0}}}),SaveEssay=Class.extend({_init:function(s){s.off().click(function(s){s.preventDefault(),SaveEssay.prototype.process()})},process:function(){var s=$("body").data("essay"),e=$("#essay-id").val(),a=$("#essay-edit").val(),t=$("#essay-finished").prop("checked");$("#essay-popup").modal("hide"),!t&&EssayWrite.prototype.isEssayFinished(s,a)?($("#Popup .modal-body").html("Would you like to mark your essay as finished? Essay cannot be submitted until marked as done."),$("#Popup .modal-footer").html('<a type="button" class="btn btn-primary center-block saveEssayFinished" data-dismiss="modal">Yes</a><a type="button" class="btn btn-primary center-block saveEssayUnfinished" data-dismiss="modal">No</a>'),$("#Popup").modal("show"),$(".saveEssayFinished").click(SaveEssay.prototype.saveFinished),$(".saveEssayUnfinished").click(SaveEssay.prototype.saveUnfinished)):SaveEssay.prototype.save(e,a,t)},save:function(s,e,a){var t=new Ajax("/api/v1.0/essay","post","json",{essayId:s,essayText:e,essayStatus:a}),o=$("input[name=_token]").val();t.onBeforeSend=function(s){s.setRequestHeader("X-CSRF-Token",o)},t.onSuccess=function(s){"ok"==s.status&&(new MyAppsTable($(".MyAppsTable")),$("#essay-popup").modal("hide"))},t.sendRequest()},saveFinished:function(s){var e=$("#essay-id").val(),a=$("#essay-edit").val();SaveEssay.prototype.save(e,a,!0)},saveUnfinished:function(s){var e=$("#essay-id").val(),a=$("#essay-edit").val();SaveEssay.prototype.save(e,a,!1)}});$(function(){readCookie("do-not-show-apps")||($("#Popup .modal-body").html("Complete essays where required by clicking the essay status. Sort your application list by deadline or amount to chose where to start."),$("#Popup .modal-footer").html('<label class="dns-label"><input name="do-not-show" type="checkbox" value="do-not-show" id="do-not-show"><span class="lbl padding-0"></span>Don\'t show this message again<br /></label><a type="button" class="btn btn-warning buttonAppsProceed" data-dismiss="modal">Ok</a>'),$("#Popup").modal("show").one("click",".buttonAppsProceed",function(){$("#do-not-show").prop("checked")&&createCookie("do-not-show-apps",1,7300)}))});